<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Reset CSS  -->
    <link rel="stylesheet" href="reset.css">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <title>Weather Dashboard</title>
</head>
<body>
    <header class="bg-dark text-center text-white p-3">
        <h1>
            Weather Dashboard
        </h1>
    </header>
    <main class="container">
        <div class="row mt-5">
            <div class="container-fluid col-3 p-0 m-2 mb-1">
                <div class="row card m-0">
                    <label for="search" class="font-weight-bold" >Search for a City:</label>
                    <input type="text" id="search" name="search" required>
                    <button class="bg-primary m-3 searchBtn">Search</button>
                </div>
                <ul class="list-group list-group-flush">      
                </ul>
            </div>
            <div class="container-fluid col-8 p-0 m-2 mt-1">
                <div class="row card m-0 p-2">
                    <div class="">
                        <h2 class='m-1 mb-3' id="city">City Name</h2>
                        <p id="temp">Temp: </p>
                        <p id="humidity">Humidity: </p>
                        <p id="wind">Wind Speed: </p>
                        <p>UV Index: <span id="uv"></span></p>
                        <!-- sa<p>UV Index: </p> <span id="uv"></span> -->
                    </div>
                </div>
                <div class="row">
                    <h5 class="m-2 ml-3">5-Day Forecast</h5>
                </div>
                <div class="row m-1 forecast"></div>
        </div>
    </main>
    <footer>

    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>
    <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
    <script src="script.js"></script>

    <!-- Function included here otherwise the historical buttons won't work -->
    <script>
        var key = "60e01cf8819d6fe551736d0879242403";
        function weather(city) {
            //Calls the weather api endpoint. This is only used to retrieve the lat, lon, and country.
            var weatherURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&appid=" + key;
            $.ajax({
                url: weatherURL,
                method: "GET"
            }) .then(function(response) {
                var oneCallURL = "https://api.openweathermap.org/data/2.5/onecall?lat=" + response.coord.lat + "&lon=" + response.coord.lon + "&units=imperial&appid=" + key;
                var country = response.sys.country;
                //Calls the OneCall endpoint to retrieve all of the current weather and 5 day
                $.ajax({
                    url: oneCallURL,
                    method: "GET"
                }) .then(function(response) {
                        
                        temp = response.current.temp;
                        humidity = response.current.humidity;
                        wind = response.current.wind_speed;
                        uvInd = response.current.uvi;
                        iconURL = "https://openweathermap.org/img/wn/" + response.current.weather[0].icon + "@2x.png";
                        var img = $("<img>");
                        img.attr({src: iconURL, alt: response.current.weather[0].description});
                        
                        $("#city").text(city + ", " + country + "  (" + moment().format("MM/DD/YYYY") + ")");
                        $("#city").append(img);
                        $("#currentIcon").attr("src", iconURL);
                        $("#temp").text("Temperature: " + temp.toString() + " F");
                        $("#humidity").text("Humidity: " + humidity.toString() + "%");
                        $("#wind").text("Wind Speed: " + wind.toString() + " MPH");
                        $("#uv").text( uvInd);
                        $("#uv").attr("display", "inline-block");
                        
                        if (uvInd >= 0 && uvInd < 3) {
                            $("#uv").addClass("bg-success p-1");
                        }
                        else if (uvInd >= 3 && uvInd <=7 )  {
                            $("#uv").addClass("bg-warning p-1");
                        }
                        else{
                            $("#uv").addClass("bg-dange p-1");
                        };
                })
            });
        };
    </script>
    
</body>
</html>